@page "/Upload"
@inject FileUploadStateService FileState
@inject NavigationManager NavManager


<MudStack Class="mx-10 my-14" Row="true" StretchItems="StretchItems.End" Spacing="9">
    <FileUploadPanel SelectedCount="@(IsSelected ? 1 : 0)"
                     ShowOptional="@ShowAllOptionalFields"
                     OnVisibilityChanged="HandleVisibilityChanged"/>
    <MudStack Spacing="4">
        <UploadBrowserToolbar TotalCount="1"
                              SelectedCount="@(IsSelected ? 1 : 0)"
                              OnSelectAllChanged="HandleSelectAllChanged"
        />
        <UploadBrowser File="@_currentFile"
                       IsSelected="@IsSelected"
                       ShowOptionalFields="@ShowAllOptionalFields"
                       OnSelectionChanged="HandleSelectionChanged"/>
    </MudStack>
</MudStack>

@code {
    private UploadedFile? _currentFile;
    private Asset _currentMetadata = new();

    private bool IsSelected = true;
    private bool ShowAllOptionalFields = false; 

    
    
    private void HandleSelectionChanged(bool selected)
    {
        IsSelected = selected;
        StateHasChanged();
    }

    private void HandleSelectAllChanged(bool selectAll)
    {
        IsSelected = selectAll;
        StateHasChanged();
    }

    private void HandleVisibilityChanged(bool visible)
    {
        ShowAllOptionalFields = visible;   
        StateHasChanged();
    }
    
    
    
    protected override void OnInitialized()
    {
        if (FileState.PendingFiles.Any())
            _currentFile = FileState.PendingFiles.First();
        else
            NavManager.NavigateTo("/Upload");
    }
    
}