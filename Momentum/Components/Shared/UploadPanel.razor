<MudPaper Class="d-flex flex-column" Outlined="true" Width="320px" style="height: 640px;">
    @* Panel Header *@
    <MudStack Class="pa-4" Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
        <MudText><b>Upload files</b></MudText>
        <VisibilityToggleButton ShowOptional="ShowOptional"
                                OnVisibilityChanged="ToggleVisibility"
                                IsGroupMode="true"/>
    </MudStack>
    <MudStack Class="overflow-auto px-4" Spacing="4">

        @* Update Title*@
        <MudStack Spacing="2">
            <MudTextField T="string"
                          @bind-Value="File.Title"
                          @bind-Value:after="NotifyParent"
                          Margin="Margin.Dense"
                          Variant="Variant.Outlined"
                          Underline="false"
                          Placeholder="Update title"
                          Immediate="true"/>
            <MudSwitch T="bool" Color="Color.Error" Size="Size.Small" Label="Use filenames as title"/>
        </MudStack>

        @*Description*@
        <MudStack Spacing="2">
            <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween">
                <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="2">
                    <MudIcon Icon="@Icons.Custom.FileFormats.FileDocument" Size="Size.Small"/>
                    <MudText Typo="Typo.subtitle2">Description</MudText>
                </MudStack>
                <VisibilityToggleButton ShowOptional="ShowOptional" OnVisibilityChanged="ToggleVisibility"/>
            </MudStack>
            <MudTextField T="string" 
                          @bind-Value="File.Description"
                          @bind-Value:after="NotifyParent"
                          Placeholder="Replace description(s)"
                          Variant="Variant.Outlined"/>
        </MudStack>
        @* Preset Selector *@
        <MudStack Spacing="2">
            <MudText><b>Preset</b></MudText>
            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                <PresetPopoverDropdown/>
                <ManagePresetsIconButton/>
            </MudStack>
        </MudStack>
        @* Expansion Panels *@
        <MudExpansionPanels Elevation="0" Gutters="false" Dense="true">
            <MudDivider/>
            <AssetTypePanel File="File" AssetTypeChanged="OnAssetTypeChanged"/>
            @if (!string.IsNullOrWhiteSpace(File?.AssetType))
            {
                <AssetSubTypePanel File="File" AssetType="@File.AssetType"/>
            }
            <UsageRightsPanel File="File"/>
            @if (File.UsageRights == "Special usage rights")
            {
                <PleaseSpecifyPanel File="File"/>
            }
            <GoalPanel File="File" OnFileChanged="NotifyParent"/>
            <TargetPersonaPanel File="File" ShowOptional="ShowOptional" OnVisibilityChanged="ToggleVisibility"/>
            <ChannelPanel File="File" ShowOptional="ShowOptional" OnVisibilityChanged="ToggleVisibility"/>
            <LaunchPanel File="File" ShowOptional="ShowOptional" OnVisibilityChanged="ToggleVisibility"/>
            <YearPanel File="File" ShowOptional="ShowOptional" OnVisibilityChanged="ToggleVisibility"/>
            <ThemePanel File="File" ShowOptional="ShowOptional" OnVisibilityChanged="ToggleVisibility"/>
            <CampaignPanel File="File" ShowOptional="ShowOptional" OnVisibilityChanged="ToggleVisibility"/>
            <InstallationsPanel File="File" ShowOptional="ShowOptional" OnVisibilityChanged="ToggleVisibility"/>
            <RelatedAssetsPanel ShowOptional="ShowOptional" OnVisibilityChanged="ToggleVisibility"/>
            <AddPublicationDatePanel File="File" ShowOptional="ShowOptional" OnVisibilityChanged="ToggleVisibility"/>
            <TagsPanel ShowOptional="ShowOptional" OnVisibilityChanged="ToggleVisibility"/>
            <CopyrightPanel File="File" ShowOptional="ShowOptional" OnVisibilityChanged="ToggleVisibility"/>
            <AdvancedRightsPanel/>
            <CustomFieldsPanel/>
            <CollectionsPanel/>
        </MudExpansionPanels>
    </MudStack>
    @if (IsSelected)
    {
        <StoreSelectedFilesButton/>
    }
</MudPaper>


@code {
    [Parameter] public UploadedFile? File { get; set; }
    [Parameter] public bool IsSelected { get; set; }
    [Parameter] public bool ShowOptional { get; set; }
    [Parameter] public EventCallback<bool> OnVisibilityChanged { get; set; }
    [Parameter] public EventCallback OnFileChanged { get; set; }

    private void ToggleVisibility()
    {
        OnVisibilityChanged.InvokeAsync(!ShowOptional);
    }

    private async Task OnAssetTypeChanged(string assetType)
    {
        await NotifyParent();
    }


    private async Task NotifyParent()
    {
        await OnFileChanged.InvokeAsync();
    }

}