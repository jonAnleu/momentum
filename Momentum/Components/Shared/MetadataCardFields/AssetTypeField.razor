<MudTooltip Text="Add Asset Type" Color="Color.Dark">
    <MudPaper Class="d-flex flex-grow-1 align-center pl-2" Outlined="true" @onclick="ToggleOpen" >
        @if (!string.IsNullOrEmpty(File?.AssetType))
        {
            <MudText Typo="Typo.caption">@File.AssetType</MudText>
        }
        else
        {
            <MudText Typo="Typo.caption">Add Asset Type</MudText>
        }
        <MudSpacer/>
        <MudDivider Vertical="true" FlexItem="true" />
        <MudIconButton Ripple="false" Icon="@Icons.Material.Sharp.KeyboardArrowRight" Size="Size.Small"/>
    </MudPaper>
</MudTooltip>

<MudPopover Open="@_open" Fixed="true" Class="pa-2">
    <MudStack Spacing="2">
        <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween" >
            <MudText Class="justify-start" Typo="Typo.caption">Add Asset Type</MudText>
            <MudIconButton 
                Variant="Variant.Filled" 
                Icon="@Icons.Material.Filled.Refresh" 
                Size="Size.Small"
                OnClick="ClearAssetType"/>
        </MudStack>
        @if (!string.IsNullOrEmpty(File?.AssetType))
        {
            <MudChip T="string" 
                     OnClose="ClearAssetType" 
                     Size="Size.Small" 
                     CloseIcon="@Icons.Material.Filled.Close">
                <MudText Typo="Typo.caption" Color="Color.Primary">@File.AssetType</MudText>
            </MudChip>
        }

        <MudSelect T="string"
                   Value="File.AssetType"
                   ValueChanged="OnAssetTypeChanged"
                   Variant="Variant.Outlined"
                   Margin="Margin.Dense" 
                   Placeholder="Select Asset Type"
                   Underline="false"
                   Immediate="true">
            @foreach (var assetType in _assetTypes)
            {
                <MudSelectItem Value="@assetType">@assetType</MudSelectItem>
            }
        </MudSelect>        
        <MudStack Class="mt-3" Row="true" Justify="Justify.FlexEnd">
            <MudButton Variant="Variant.Filled" 
                       Color="Color.Error" 
                       Size="Size.Small" 
                       OnClick="ToggleOpen">OK</MudButton>
        </MudStack>
    </MudStack>
</MudPopover>

@code{
    [Parameter] public UploadedFile? File { get; set; } 
    [Parameter] public EventCallback<string> AssetTypeChanged { get; set; }

    private bool _open;

    private void ToggleOpen() => _open = !_open;
    
    private readonly string[] _assetTypes =
    {
        "Audio", "Document", "Graphic/Visual", "Photography", "Video"
    };
    
    private async Task OnAssetTypeChanged(string newValue)
    {
        if (File is not null)
            File.AssetType = newValue;

        await AssetTypeChanged.InvokeAsync(newValue);
    }

    private async Task ClearAssetType()
    {
        if (File is not null)
            File.AssetType = string.Empty;

        await AssetTypeChanged.InvokeAsync(string.Empty);
    }
}
