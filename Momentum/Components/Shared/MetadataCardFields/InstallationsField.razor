<MudTooltip Text="Add Installation" Color="Color.Dark">
    <MudPaper Class="d-flex flex-grow-1 align-center pl-2" Outlined="true" @onclick="ToggleOpen">
        @if (File.Installations.Count == 0)
        {
        <MudText Typo="Typo.caption">Add Installation</MudText>
        }
        else
        {
            <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
                <MudText Typo="Typo.caption">
                    @string.Join(", ", File.Installations)
                </MudText>
            </MudStack>
        }
        <MudSpacer/>
        <MudDivider Vertical="true" FlexItem="true"/>
        <MudIconButton Ripple="false" Icon="@Icons.Material.Sharp.KeyboardArrowRight" Size="Size.Small"/>
    </MudPaper>
</MudTooltip>

<MudPopover Open="@_open" Fixed="true" Class="pa-2">
    <MudStack Spacing="2">
        <MudStack Row="true" AlignItems="AlignItems.Center" Justify="Justify.SpaceBetween" >
            <MudText Class="justify-start" Typo="Typo.caption">Add Installation</MudText>
            <MudIconButton Variant="Variant.Filled" Icon="@Icons.Material.Filled.Refresh" Size="Size.Small"/>
        </MudStack>
        
        @if (File?.Installations != null)
        {
            <MudStack Row="true" AlignItems="AlignItems.Center" Wrap="Wrap.Wrap" Spacing="0">
                @foreach (var installation in File.Installations)
                {
                    <MudChip T="string"
                             OnClose="@(() => RemoveInstallation(installation))"
                             Size="Size.Small"
                             CloseIcon="@Icons.Material.Filled.Close">
                        <MudText Typo="Typo.caption" Color="Color.Primary">@installation</MudText>
                    </MudChip>
                }
            </MudStack>
        }
        <MudSelect T="string"
                   MultiSelection="true"
                   Variant="Variant.Outlined"
                   Margin="Margin.Dense"
                   Placeholder="Select Installation"
                   Underline="false"
                   SelectedValues="File.Installations"
                   SelectedValuesChanged="@(vals => File.Installations = vals.ToList())">
        @foreach (var installation in _installations)
        {
            <MudSelectItem Value="@installation">@installation</MudSelectItem>
        }
        </MudSelect>
        <MudStack Class="mt-3" Row="true" Justify="Justify.FlexEnd">
            <MudButton Variant="Variant.Filled" Color="Color.Error" Size="Size.Small" OnClick="ToggleOpen">OK</MudButton>
        </MudStack>
    </MudStack>
</MudPopover>

@code{
    [Parameter] public UploadedFile? File { get; set; }
    private bool _open;
    private void ToggleOpen() => _open = !_open;
      
    private readonly string[] _installations =
    {
        "Albany", "Beaufort", "Cherry Point", "Vendors"
    };
    private void RemoveInstallation(string installation)
    {
        if (File?.Installations == null) return;
        File.Installations.Remove(installation);
    }
}