<MudExpansionPanel HeaderClass="pa-0" Gutters="false" Dense="true" HideIcon="true">
    <TitleContent>
        <MudStack Row="true" AlignItems="AlignItems.Center" Spacing="1">
            <MudIcon Size="Size.Small">
                <i class="fa-solid fa-sitemap fa-2xs"></i>
            </MudIcon>
            <MudText Typo="Typo.subtitle2">Goal</MudText>
            <MudText Color="Color.Error" Typo="Typo.body2">*</MudText>
        </MudStack>
    </TitleContent>
    <ChildContent>
            @if (File?.Goals != null)
            {
                <MudStack Row="true" AlignItems="AlignItems.Center" Wrap="Wrap.Wrap" Spacing="0">
                    @foreach (var goal in File.Goals)
                    {
                        <MudChip T="string"
                                 OnClose="@(() => RemoveGoal(goal))"
                                 Size="Size.Small"
                                 CloseIcon="@Icons.Material.Filled.Close">
                            <MudText Typo="Typo.caption" Color="Color.Primary">@goal</MudText>
                        </MudChip>
                    }
                </MudStack>
            }
            <MudSelect T="string"
                       MultiSelection="true"
                       Variant="Variant.Outlined"
                       Margin="Margin.Dense"
                       Placeholder="Select Goal"
                       Underline="false"
                       SelectedValues="File.Goals"
                       SelectedValuesChanged="OnGoalsChanged">
                @foreach (var goal in _goals)
                {
                    <MudSelectItem Value="@goal">@goal</MudSelectItem>
                }
            </MudSelect>
    </ChildContent>
</MudExpansionPanel>

@code
{
    [Parameter] public UploadedFile? File { get; set; }
    [Parameter] public EventCallback OnFileChanged { get; set; }
    
    private readonly string[] _goals =
    {
        "Brand Awareness", "Customer Loyalty", "New Customers", "Product Launch"
    };
    
    private async Task RemoveGoal(string goal)
    {
        if (File?.Goals == null) return;
        File.Goals.Remove(goal);
        await OnFileChanged.InvokeAsync();
    }
    
    private async Task OnGoalsChanged(IEnumerable<string> vals)
    {
        if (File != null)
        {
            File.Goals = vals.ToList();
            await OnFileChanged.InvokeAsync();
        }
    }
}